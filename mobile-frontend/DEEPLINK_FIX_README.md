# Решение проблемы Deeplink для родителей с одним студентом

## Проблема

Когда у родителя только один студент, главная страница со списком студентов автоматически пропускается, но deeplink всё ещё пытается навигироваться по старой схеме. Это приводило к неправильной навигации при открытии приложения через deeplink.

## Решение

### 1. Модифицирован `native-intent.ts`

- Добавлена функция `getSmartNavigationPath()` для умной обработки путей
- Функция проверяет количество студентов из AsyncStorage
- Для случая с одним студентом корректирует home пути на прямую навигацию к студенту

### 2. Обновлён `student-context.tsx`

- Добавлено сохранение метаданных в AsyncStorage при загрузке студентов
- Сохраняется количество студентов и ID единственного студента
- Метаданные обновляются как для онлайн, так и для оффлайн режимов

### 3. Улучшен `StudentSelector.tsx`

- Дублированное сохранение метаданных при автонавигации
- Обеспечивает немедленную доступность данных для deeplink

### 4. Обновлён главный `_layout.tsx`

- Интегрирована умная навигация в обработчик deeplink
- Улучшена логика для HTTPS deeplink с учётом случая одного студента
- Оптимизированы тайминги навигации

## Логика работы

### Множественные студенты:

- Home deeplink → Список студентов
- Student deeplink → Страница студента
- Message deeplink → Home → Student → Message

### Один студент:

- Home deeplink → Автоматически к студенту
- Student deeplink → Страница студента (без изменений)
- Message deeplink → Home → Автонавигация к студенту → Message

## Ключевые улучшения:

1. ✅ Deeplink работает корректно для родителей с одним студентом
2. ✅ Сохранена существующая UX логика автонавигации
3. ✅ Поддержка как dev схем (jduapp), так и production HTTPS ссылок
4. ✅ Оффлайн совместимость через сохранение в AsyncStorage
5. ✅ Правильная навигационная история для кнопки "Назад"
